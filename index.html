<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PosterBox | Viral Campaign Platform</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #4f46e5; --dark: #0f172a; --light: #f8fafc; --secondary: #64748b; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--light); color: var(--dark); overflow-x: hidden; }
        
        /* Header */
        header { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.95); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #e2e8f0; }
        .logo { font-size: 1.3rem; font-weight: 800; display: flex; align-items: center; gap: 8px; color: var(--dark); text-decoration: none; }
        .logo-icon { width: 30px; height: 30px; background: var(--primary); color: white; border-radius: 8px; display: grid; place-items: center; }
        
        .nav-links { display: flex; gap: 20px; align-items: center; }
        .nav-link { display: none; } /* Hidden on mobile by default */
        .btn-cta { background: var(--dark); color: white; padding: 10px 20px; border-radius: 50px; text-decoration: none; font-weight: 700; font-size: 0.9rem; transition: 0.2s; }
        .btn-cta:hover { transform: translateY(-2px); background: var(--primary); }

        /* Hero Section */
        .hero { padding: 60px 5%; text-align: center; }
        h1 { font-size: 2.5rem; line-height: 1.1; margin-bottom: 20px; font-weight: 800; letter-spacing: -1px; color: var(--dark); }
        .gradient-text { background: linear-gradient(to right, #4f46e5, #9333ea); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        p.subtitle { font-size: 1.1rem; color: var(--secondary); margin-bottom: 30px; line-height: 1.5; }

        /* Search Bar */
        .search-wrapper { position: relative; max-width: 500px; margin: 0 auto; }
        .search-input { width: 100%; padding: 15px 20px 15px 50px; border-radius: 50px; border: 1px solid #cbd5e1; font-size: 1rem; outline: none; transition: 0.2s; }
        .search-input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); }
        .search-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); opacity: 0.5; }

        /* Stats */
        .stats-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 30px; margin-top: 40px; }
        .stat-item { text-align: center; min-width: 100px; }
        .stat-num { font-size: 1.8rem; font-weight: 800; display: block; color: var(--dark); }
        .stat-label { font-size: 0.75rem; color: var(--secondary); text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }

        /* Campaign Grid */
        .campaigns { padding: 40px 5% 80px; background: white; }
        .grid { display: grid; grid-template-columns: 1fr; gap: 25px; max-width: 1200px; margin: 0 auto; } 
        
        .card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; transition: 0.2s; cursor: pointer; }
        .card:active { transform: scale(0.98); }
        .card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        .card-img { height: 200px; background: #f1f5f9; overflow: hidden; position: relative; }
        .card-img img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .card-content { padding: 20px; }
        .card h3 { font-size: 1.3rem; font-weight: 800; margin-bottom: 8px; color: var(--dark); }
        .btn-card { width: 100%; padding: 12px; background: white; border: 2px solid #e2e8f0; border-radius: 10px; font-weight: 700; margin-top: 15px; cursor: pointer; color: var(--dark); }
        .btn-card:hover { background: var(--dark); color: white; border-color: var(--dark); }

        /* Footer */
        footer { padding: 40px 5%; text-align: center; border-top: 1px solid #e2e8f0; background: #f8fafc; }
        .footer-links { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .footer-link { color: var(--secondary); font-weight: 600; font-size: 0.9rem; text-decoration: none; }
        .copyright { color: #94a3b8; font-size: 0.8rem; }

        /* Desktop Adjustments (Media Query) */
        @media (min-width: 768px) {
            .nav-link { display: block; color: var(--secondary); text-decoration: none; font-weight: 600; }
            .nav-link:hover { color: var(--primary); }
            h1 { font-size: 4rem; }
            .grid { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
        }
    </style>
</head>
<body>
    <header>
        <a href="#" class="logo"><div class="logo-icon">P</div>PosterBox</a>
        <div class="nav-links">
            <a href="login.html" class="nav-link">Log In</a>
            <a href="login.html" class="btn-cta">Start Campaign</a>
        </div>
    </header>
    
    <section class="hero">
        <h1>Make Your Voice <br><span class="gradient-text">Visually Louder.</span></h1>
        <p class="subtitle">Create and share viral campaign posters instantly.</p>
        
        <div class="search-wrapper">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-input" id="searchInput" placeholder="Search campaigns..." onkeyup="filterCampaigns()">
        </div>

        <div class="stats-container">
            <div class="stat-item"><span class="stat-num" id="count-posters">0</span><span class="stat-label">Posters</span></div>
            <div class="stat-item"><span class="stat-num" id="count-users">0</span><span class="stat-label">Users</span></div>
            <div class="stat-item"><span class="stat-num" id="count-views">0</span><span class="stat-label">Views</span></div>
        </div>
    </section>
    
    <section class="campaigns">
        <div class="grid" id="grid">
            <div style="grid-column:1/-1; text-align:center; padding:60px; color:#64748b;">
                <div style="font-size:2rem; margin-bottom:10px;">‚è≥</div>
                Loading Campaigns...
            </div>
        </div>
    </section>
    
    <footer>
        <div class="footer-links">
            <a href="#" class="footer-link">About Us</a>
            <a href="login.html" class="footer-link">Client Portal</a>
            <a href="#" class="footer-link">Privacy Policy</a>
            </div>
        <p class="copyright">&copy; 2025 PosterBox Inc.</p>
    </footer>
    
    <script src="db.js"></script>
    
    <script>
        let activeCamps = [];

        // 1. Fetch Campaigns from Cloud
        window.getAllCampaigns().then(allCamps => {
            // Filter out deleted/inactive
            activeCamps = allCamps.filter(c => c.active !== false);
            renderGrid(activeCamps);

            // 2. Fetch Real Stats
            window.getSiteStats().then(s => {
                animateValue('count-posters', 0, s.campaigns, 1500);
                animateValue('count-users', 0, s.users, 1500);
                animateValue('count-views', 0, s.views, 2000);
            });
        }).catch(err => {
            document.getElementById('grid').innerHTML = '<div style="padding:20px; text-align:center; color:red;">Connection Error. Please refresh.</div>';
        });

        // Grid Renderer
        const grid = document.getElementById('grid');
        function renderGrid(data) {
            grid.innerHTML = '';
            
            if(data.length === 0) { 
                grid.innerHTML = '<div style="grid-column:1/-1; padding:40px; text-align:center; color:#64748b;">No campaigns found. Be the first to start one!</div>'; 
                return; 
            }

            data.forEach((c, index) => {
                // Staggered Animation for smooth feel
                const delay = index * 100;
                
                const html = `
                    <div class="card" style="animation: fadeInUp 0.5s ease forwards; opacity:0; animation-delay:${delay}ms" onclick="location.href='generate.html?id=${c.id}'">
                        <div class="card-img">
                            <img src="${c.image}" alt="${c.title}" crossorigin="anonymous" loading="lazy">
                        </div>
                        <div class="card-content">
                            <h3>${c.title}</h3>
                            <p style="color:#64748b; font-size:0.9rem; margin-bottom:15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${c.desc || 'Join the movement and create your poster.'}</p>
                            <button class="btn-card">‚ú® Create Poster</button>
                        </div>
                    </div>`;
                grid.innerHTML += html;
            });
        }

        // Search Filter
        window.filterCampaigns = function() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const filtered = activeCamps.filter(c => 
                c.title.toLowerCase().includes(q) || 
                (c.desc && c.desc.toLowerCase().includes(q))
            );
            renderGrid(filtered);
        }

        // Stats Animation
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }

        // CSS Animation Keyframes injection
        const style = document.createElement('style');
        style.innerHTML = `@keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }`;
        document.head.appendChild(style);
    </script>
</body>
</html>